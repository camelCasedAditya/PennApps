{% load static %}
<div class="sidebar">
  <div class="sidebar-header">
    <div class="course-title">Course</div>
    {% if course_generation %}
      <div class="course-subtitle">{{ course_generation.user_prompt|default:"Generated Course" }}</div>
    {% endif %}
  </div>
  <div class="chapters">
    {% for ch in sidebar_chapters %}
      <div class="chapter">
        <button class="chapter-toggle" onclick="this.classList.toggle('open');this.nextElementSibling.classList.toggle('open')">
          <span>Chapter {{ ch.chapter_number }}: {{ ch.chapter_name }}</span>
          <span class="chevron">‚ñæ</span>
        </button>
        <ul class="lessons-list">
          {% for l in ch.lessons.all %}
            <li class="lesson {% if l.id == current_lesson_id %}active{% endif %}">
              {% if l.lesson_type == 'vid' %}
                <a href="{% url 'generation:lesson_youtube' l.id %}" class="lesson-link">üé¨ {{ l.lesson_name }}</a>
              {% elif l.lesson_type == 'int' or l.lesson_type == 'code' %}
                <a href="{% url 'generation:load_lesson_project' l.id %}" class="lesson-link">üíª {{ l.lesson_name }}</a>
              {% elif l.lesson_type == 'mcq' and l.quiz %}
                <a href="{% url 'generation:take_quiz' l.quiz.id %}" class="lesson-link">üìù {{ l.lesson_name }}</a>
              {% elif l.lesson_type == 'art' and l.article %}
                <a href="{% url 'generation:lesson_article' l.id %}" class="lesson-link">üìñ {{ l.lesson_name }}</a>
              {% elif l.lesson_type == 'ext' and l.external_article %}
                <a href="{% url 'generation:lesson_external' l.id %}" class="lesson-link">üîó {{ l.lesson_name }}</a>
              {% else %}
                <span class="lesson-link disabled" title="Not available yet">{{ l.lesson_name }}</span>
              {% endif %}
              <span class="badge">{{ l.lesson_type|upper }}</span>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endfor %}
  </div>
</div>

<style>
  .layout { display: flex; min-height: 100vh; }
  .sidebar { width: 280px; background: #0f172a; color: #e2e8f0; padding: 16px; overflow-y: auto; }
  .sidebar-header { margin-bottom: 12px; }
  .course-title { font-weight: 700; font-size: 18px; }
  .course-subtitle { font-size: 12px; color: #94a3b8; margin-top: 4px; word-break: break-word; }
  .chapters { margin-top: 8px; }
  .chapter { margin-bottom: 10px; }
  .chapter-toggle { width: 100%; background: #1e293b; color: #e2e8f0; border: none; padding: 10px; border-radius: 6px; text-align: left; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
  .chapter-toggle .chevron { transition: transform .2s ease; }
  .chapter-toggle.open .chevron { transform: rotate(180deg); }
  .lessons-list { list-style: none; margin: 6px 0 0 0; padding: 0 0 0 4px; display: none; }
  .lessons-list.open { display: block; }
  .lesson { display: flex; align-items: center; justify-content: space-between; padding: 6px 8px; border-radius: 6px; }
  .lesson.active { background: #0b2239; }
  .lesson-link { color: #e2e8f0; text-decoration: none; font-size: 14px; }
  .lesson-link:hover { text-decoration: underline; }
  .lesson-link.disabled { color: #64748b; cursor: default; }
  .badge { font-size: 10px; background: #334155; color: #cbd5e1; padding: 2px 6px; border-radius: 10px; margin-left: 8px; }
  .content { flex: 1; background: #f8fafc; min-height: 100vh; }
</style>
